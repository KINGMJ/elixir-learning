# 5. 关键字列表和映射

代码见`demo3.ex`

在Elixir中，我们有两个主要的关联数据结构：关键字列表和映射。

## 关键字列表（keyword lists）

有一个元组列表，并且元组的第一项（key）是一个原子，称之为关键字列表

```
iex> list = [{:a, 1}, {:b, 2}]
[a: 1, b: 2]
iex> list == [a: 1, b: 2]
true
```

获取关键字列表key的值

```
iex> list = [{:a, 1},{:b, 2}] 
[a: 1, b: 2]

iex> list[:a] 
1
```

`if/2`宏支持以下语法，`do:`和`else:`实际上是关键字列表

```
iex> if false, do: :this, else: :that
:that
```

关键字列表作为**函数的最后一个参数**传递时，支持另一种特殊语法。方括号`[]`是可选的

```
defmodule Exercise do
  def test(a, b, c) do
  end
end

iex> Exercise.test(1, 2, trim: true) 
nil
iex> Exercise.test(1, trim: true, 2) 
** (SyntaxError) iex:5: syntax error before: "2"

iex> Exercise.test(1, [trim: true], 2) 
nil
```

### Keyword 模块

`Keyword.fetch/2` 返回键的值，以`{:ok, value}`的形式返回

`Keyword.get/3` 返回键的值，如果找不到返回`nil`，或者提供一个默认的值

```
iex> list = [name: "jack", age: 18] 
[name: "jack", age: 18]
iex> Keyword.fetch(list,:name)
{:ok, "jack"}
iex> Keyword.fetch(list,:sex)
:error
iex> Keyword.get(list,:name)
"jack"
iex> Keyword.get(list,:sex)
nil
iex> Keyword.get(list,:sex,"male")  
"male"
```

## 映射（map）

map使用`%{}`语法创建

获取key的值：`map[key]`

```
iex> map = %{:a => 1, 2 => :b}
%{2 => :b, :a => 1}
iex> map[:a]
1
iex> map[2]
:b
iex> map[:c]
nil
```

`Map.get`获取key的值

`Map.put`插入值

`Map.to_list`将map转换为列表

```
iex> Map.get(%{:a => 1, 2 => :b}, :a)
1
iex> Map.put(%{:a => 1, 2 => :b}, :c, 3)
%{2 => :b, :a => 1, :c => 3}
iex> Map.to_list(%{:a => 1, 2 => :b})
[{2, :b}, {:a, 1}]
```

更新key的值

```
iex> map = %{:a => 1, 2 => :b}
%{2 => :b, :a => 1}

iex> %{map | 2 => "two"}
%{2 => "two", :a => 1}
```

map中所有key都是原子，可以简写

```
iex> map = %{a: 1, b: 2}
%{a: 1, b: 2}
```
可以通过`.`访问原子的键

```
iex> map = %{:a => 1, 2 => :b}
%{2 => :b, :a => 1}

iex> map.a
1
```

## 嵌套数据结构

```
iex> users = [
  john: %{name: "John", age: 27, languages: ["Erlang", "Ruby", "Elixir"]},
  mary: %{name: "Mary", age: 29, languages: ["Elixir", "F#", "Clojure"]}
]
```

获取值：

```
iex> users[:john].age
27
```

